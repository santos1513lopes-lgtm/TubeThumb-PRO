<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TubeThumb PRO - Live Version</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Anton&family=Bangers&family=Montserrat:wght@700;900&family=Oswald:wght@500;700&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            background-color: #0f172a; /* Slate 900 */
            color: #f3f4f6;
            font-family: 'Montserrat', sans-serif;
            overflow-x: hidden;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }

        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        .canvas-container {
            background-image: 
                linear-gradient(45deg, #1e293b 25%, transparent 25%), 
                linear-gradient(-45deg, #1e293b 25%, transparent 25%), 
                linear-gradient(45deg, transparent 75%, #1e293b 75%), 
                linear-gradient(-45deg, transparent 75%, #1e293b 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
    </style>
</head>
<body class="selection:bg-red-500/30 pb-20">

    <header class="border-b border-gray-800 bg-gray-900/95 backdrop-blur-md sticky top-0 z-50 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="bg-gradient-to-br from-red-600 to-orange-600 p-2 rounded-xl shadow-lg shadow-red-500/20 transform hover:scale-105 transition-transform">
                    <svg class="w-6 h-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                <div>
                    <h1 class="text-2xl font-black tracking-tighter italic text-white leading-none">TubeThumb</h1>
                    <span class="text-[10px] font-bold text-red-500 tracking-widest uppercase">Professional Edition</span>
                </div>
            </div>
            <div class="flex gap-2">
                <button id="btnResetApp" class="flex items-center gap-2 bg-gray-800 hover:bg-gray-700 text-gray-300 px-4 py-2 rounded-full text-xs font-bold transition-all border border-gray-700 hover:border-gray-500" title="Reset all settings (keeps image)">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                    Reset
                </button>
                <button id="btnMagicRemix" class="flex items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white px-5 py-2 rounded-full text-xs font-bold transition-all shadow-lg hover:shadow-indigo-500/50 border border-white/10">
                    <svg class="w-4 h-4 animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>
                    Magic Remix
                </button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 py-8 grid grid-cols-1 lg:grid-cols-12 gap-8">
        
        <div class="lg:col-span-4 space-y-4 h-full">
            
            <div class="bg-gray-800/50 p-5 rounded-2xl border border-gray-700/50 hover:border-gray-600 transition-colors">
                <h2 class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-blue-500"></span> Source & Adjustments
                </h2>
                
                <label class="group relative flex flex-col items-center justify-center w-full h-24 border-2 border-dashed border-gray-700 rounded-xl cursor-pointer hover:bg-gray-800 hover:border-blue-500 transition-all overflow-hidden bg-gray-900/50 mb-5">
                    <img id="previewThumb" class="absolute inset-0 w-full h-full object-cover opacity-40 group-hover:opacity-20 transition-opacity hidden" />
                    <div class="flex flex-col items-center justify-center z-10 text-gray-400 group-hover:text-blue-400 transition-colors">
                        <svg class="w-6 h-6 mb-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                        <span class="text-xs font-bold" id="uploadText">Click to Upload Image</span>
                    </div>
                    <input type="file" id="imageInput" class="hidden" accept="image/*" />
                </label>

                <div class="grid grid-cols-3 gap-4">
                    <div class="space-y-1">
                        <label class="text-[9px] font-bold text-gray-500 uppercase">Brightness</label>
                        <input type="range" id="filterBrightness" min="50" max="150" value="100" class="w-full h-1 bg-gray-700 rounded-full appearance-none cursor-pointer accent-blue-500">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[9px] font-bold text-gray-500 uppercase">Contrast</label>
                        <input type="range" id="filterContrast" min="50" max="150" value="100" class="w-full h-1 bg-gray-700 rounded-full appearance-none cursor-pointer accent-blue-500">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[9px] font-bold text-gray-500 uppercase">Saturation</label>
                        <input type="range" id="filterSaturate" min="0" max="200" value="100" class="w-full h-1 bg-gray-700 rounded-full appearance-none cursor-pointer accent-blue-500">
                    </div>
                </div>
            </div>

            <div class="bg-gray-800/50 p-5 rounded-2xl border border-gray-700/50 hover:border-gray-600 transition-colors">
                <h2 class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-yellow-500"></span> Headline
                </h2>
                <textarea id="textContent" class="w-full h-20 bg-gray-900 border-2 border-gray-700 rounded-xl px-4 py-3 text-lg font-black text-white focus:border-yellow-500 focus:outline-none resize-none placeholder-gray-600 transition-colors" placeholder="ENTER YOUR TITLE HERE">WATCH THIS!</textarea>
            </div>

            <div class="bg-gray-800/50 p-5 rounded-2xl border border-gray-700/50 hover:border-gray-600 transition-colors">
                 <h2 class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-red-500"></span> Stickers & Assets
                </h2>
                
                <div class="space-y-5">
                    <div>
                        <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide" id="shapeButtons"></div>
                    </div>

                    <div>
                         <div class="grid grid-cols-6 gap-2" id="emojiButtons"></div>
                    </div>

                    <div id="stickerControls" class="pt-4 border-t border-gray-700 hidden animate-fade-in">
                        <div class="flex justify-between items-center mb-3">
                             <span class="text-[10px] font-bold text-blue-400 uppercase flex items-center gap-1">
                                <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                                Edit Selected
                             </span>
                             <div class="flex gap-2">
                                 <button id="btnFlipSticker" class="bg-gray-700 hover:bg-gray-600 text-white text-[10px] px-3 py-1 rounded-full font-bold transition-colors">FLIP ‚Üî</button>
                                 <button id="btnDeleteSticker" class="bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white p-1 rounded-full transition-colors">
                                     <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                 </button>
                             </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="space-y-1">
                                <label class="text-[9px] font-bold text-gray-500 uppercase">Scale</label>
                                <input type="range" id="stickerScale" min="0.2" max="3" step="0.1" value="1" class="w-full h-1 bg-gray-700 rounded-full appearance-none cursor-pointer accent-blue-500">
                            </div>
                            <div class="space-y-1">
                                <label class="text-[9px] font-bold text-gray-500 uppercase">Rotate</label>
                                <input type="range" id="stickerRotation" min="-180" max="180" value="0" class="w-full h-1 bg-gray-700 rounded-full appearance-none cursor-pointer accent-blue-500">
                            </div>
                        </div>
                    </div>
                    <div id="noStickerSelected" class="text-xs text-gray-600 font-medium text-center py-2 border-t border-gray-800">
                        Select an item on canvas to edit
                    </div>
                </div>
            </div>

            <div class="bg-gray-800/50 p-5 rounded-2xl border border-gray-700/50 hover:border-gray-600 transition-colors">
                <h2 class="text-[10px] font-bold text-gray-400 uppercase tracking-widest mb-4 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-purple-500"></span> Typography Style
                </h2>

                <div class="space-y-4">
                   <div class="grid grid-cols-2 gap-2" id="fontButtons"></div>
                   
                   <div class="bg-gray-900 rounded-xl p-3 border border-gray-700 flex justify-between items-center">
                        <div class="flex gap-2" id="colorButtons"></div>
                        <div class="w-px h-6 bg-gray-700 mx-2"></div>
                        <input type="color" id="colorPicker" value="#FFFFFF" class="w-8 h-8 rounded-full bg-transparent border-0 p-0 cursor-pointer hover:scale-110 transition-transform">
                   </div>

                   <div class="grid grid-cols-2 gap-4">
                       <div class="space-y-1">
                            <label class="text-[9px] font-bold text-gray-500 uppercase">Font Size</label>
                            <input type="range" id="fontSize" min="40" max="250" value="140" class="w-full h-1 bg-gray-700 rounded-full appearance-none cursor-pointer accent-white"/>
                       </div>
                       <div class="space-y-1">
                            <label class="text-[9px] font-bold text-gray-500 uppercase">Outline</label>
                            <input type="range" id="strokeWidth" min="0" max="40" value="15" class="w-full h-1 bg-gray-700 rounded-full appearance-none cursor-pointer accent-red-500"/>
                       </div>
                   </div>
                </div>
            </div>

            <div class="bg-gray-800/50 p-5 rounded-2xl border border-gray-700/50 hover:border-gray-600 transition-colors">
                 <div class="flex justify-between items-center mb-4">
                    <h2 class="text-[10px] font-bold text-gray-400 uppercase tracking-widest flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-green-500"></span> Quick Layout
                    </h2>
                    <button id="btnSafeZone" class="text-[10px] px-2 py-0.5 rounded border border-gray-600 text-gray-400 hover:text-white transition-colors">
                        Safe Zone
                    </button>
                 </div>
                 <div class="grid grid-cols-3 gap-2 aspect-[3/1.5]" id="layoutGrid"></div>
            </div>
        </div>

        <div class="lg:col-span-8">
            <div class="sticky top-28 space-y-6">
                
                <div class="relative w-full aspect-video rounded-2xl overflow-hidden shadow-2xl border-2 border-gray-700 bg-gray-900 canvas-container group">
                    <canvas id="mainCanvas" class="w-full h-full object-contain cursor-crosshair touch-none"></canvas>
                    
                    <div class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity bg-black/70 backdrop-blur px-3 py-1.5 rounded-lg text-xs font-medium text-white pointer-events-none border border-white/10">
                        Drag to move ‚Ä¢ Scroll to resize
                    </div>
                </div>

                <div class="flex flex-col items-center gap-3">
                    <button id="btnDownload" class="flex items-center gap-3 px-10 py-4 rounded-full font-black text-xl tracking-wide transition-all transform hover:scale-105 hover:-translate-y-1 bg-gradient-to-r from-red-600 to-orange-600 text-white shadow-xl shadow-red-900/30 cursor-not-allowed grayscale opacity-50" disabled>
                        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4-4m0 0l-4 4m4-4v12" /></svg>
                        DOWNLOAD THUMBNAIL
                    </button>
                    <div id="downloadStatus" class="flex items-center gap-2 text-green-400 text-sm font-bold opacity-0 transition-opacity">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        <span id="statusText">Image saved successfully!</span>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-8">
                    <div class="bg-gray-800/50 p-4 rounded-xl border border-gray-700/50">
                        <h3 class="text-red-400 font-bold text-xs uppercase mb-1 flex items-center gap-2">üî• High CTR</h3>
                        <p class="text-gray-400 text-xs leading-relaxed">Bright faces and high contrast text can increase clicks by up to 30%.</p>
                    </div>
                    <div class="bg-gray-800/50 p-4 rounded-xl border border-gray-700/50">
                        <h3 class="text-blue-400 font-bold text-xs uppercase mb-1 flex items-center gap-2">üìè Composition</h3>
                        <p class="text-gray-400 text-xs leading-relaxed">Use the 'Rule of Thirds' layout buttons to perfectly position your text.</p>
                    </div>
                    <div class="bg-gray-800/50 p-4 rounded-xl border border-gray-700/50">
                        <h3 class="text-green-400 font-bold text-xs uppercase mb-1 flex items-center gap-2">‚ö° Pro Tip</h3>
                        <p class="text-gray-400 text-xs leading-relaxed">Arrows create curiosity. Point them at the most interesting part of the image.</p>
                    </div>
                </div>

            </div>
        </div>
    </main>

<script>
    const FONTS = [{ name: 'Impact', value: 'Anton' }, { name: 'Bold', value: 'Montserrat' }, { name: 'Modern', value: 'Oswald' }, { name: 'Comic', value: 'Bangers' }];
    const COLORS = ['#FFFFFF', '#FFFF00', '#FF0000', '#00FF00', '#00FFFF', '#FF00FF'];
    const EMOJIS = ['üò±', 'ü§î', 'üî•', 'üí∞', 'üöÄ', '‚ö†Ô∏è', '‚úÖ', '‚ùå', 'ü§°', 'üò≠', 'ü§Ø', 'üíé'];

    const ARROW_CURVED = `data:image/svg+xml;utf8,<svg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'><path d='M20,150 Q50,50 150,50 L130,20 L180,50 L130,80 L150,50' fill='red' stroke='white' stroke-width='8' stroke-linejoin='round' /></svg>`;
    const ARROW_STRAIGHT = `data:image/svg+xml;utf8,<svg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'><path d='M20,100 L120,100 L120,70 L180,110 L120,150 L120,120 L20,120 Z' fill='red' stroke='white' stroke-width='8' stroke-linejoin='round' /></svg>`;
    const ARROW_POINTER = `data:image/svg+xml;utf8,<svg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'><path d='M80,180 L80,100 L50,130 L100,20 L150,130 L120,100 L120,180 Z' fill='red' stroke='white' stroke-width='8' stroke-linejoin='round' /></svg>`;
    const SHAPE_CIRCLE = `data:image/svg+xml;utf8,<svg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'><circle cx='100' cy='100' r='80' fill='none' stroke='red' stroke-width='12' stroke-dasharray='20,10' /></svg>`;
    const SHAPE_SQUARE = `data:image/svg+xml;utf8,<svg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'><rect x='20' y='20' width='160' height='160' fill='none' stroke='red' stroke-width='12' stroke-linejoin='round' /></svg>`;
    const BADGE_LIVE = `data:image/svg+xml;utf8,<svg viewBox='0 0 200 100' xmlns='http://www.w3.org/2000/svg'><rect x='10' y='10' width='180' height='80' rx='10' fill='red' /><text x='100' y='65' font-family='Arial' font-weight='bold' font-size='50' fill='white' text-anchor='middle'>LIVE</text></svg>`;

    const SHAPE_BUTTONS = [
        { name: 'Curved', src: ARROW_CURVED }, { name: 'Straight', src: ARROW_STRAIGHT }, { name: 'Pointer', src: ARROW_POINTER },
        { name: 'Circle', src: SHAPE_CIRCLE }, { name: 'Square', src: SHAPE_SQUARE }, { name: 'Live', src: BADGE_LIVE }
    ];

    const state = {
        image: null,
        text: "WATCH THIS!", textColor: "#FFFFFF", fontFamily: "Anton", fontSize: 140, strokeWidth: 15, shadowBlur: 20, textPosition: 'center',
        showSafeZone: true,
        stickers: [], selectedStickerId: null, isDragging: false, dragOffset: { x: 0, y: 0 },
        filters: { brightness: 100, contrast: 100, saturate: 100 }
    };

    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    const btnDownload = document.getElementById('btnDownload');
    const stickerControls = document.getElementById('stickerControls');
    const noStickerSelected = document.getElementById('noStickerSelected');

    function init() { renderUI(); setupEventListeners(); resizeCanvas(); drawCanvas(); }

    function renderUI() {
        document.getElementById('fontButtons').innerHTML = FONTS.map(font => `<button onclick="setFont('${font.value}')" class="text-xs py-2 px-1 rounded-lg border transition-all ${state.fontFamily === font.value ? 'bg-white text-black border-white font-bold shadow-sm' : 'bg-gray-800 text-gray-400 border-gray-700 hover:border-gray-500'}" style="font-family: ${font.value}">${font.name}</button>`).join('');
        document.getElementById('colorButtons').innerHTML = COLORS.map(color => `<button onclick="setColor('${color}')" class="w-6 h-6 rounded-full border-2 ${state.textColor === color ? 'border-white scale-125 shadow-md' : 'border-transparent'} transition-transform" style="background-color: ${color}"></button>`).join('');
        document.getElementById('layoutGrid').innerHTML = ['top-left', 'top-center', 'top-right', 'mid-left', 'center', 'mid-right', 'bottom-left', 'bottom-center', 'bottom-right'].map(pos => `<button onclick="setPosition('${pos}')" class="rounded hover:bg-gray-700 transition-colors border ${state.textPosition === pos ? 'bg-gray-700 border-white/50' : 'bg-gray-800/50 border-gray-700'} flex items-center justify-center"><div class="w-1.5 h-1.5 rounded-full ${state.textPosition === pos ? 'bg-red-500' : 'bg-gray-600'}"></div></button>`).join('');
        document.getElementById('shapeButtons').innerHTML = SHAPE_BUTTONS.map((shape, idx) => `<button onclick="addShape(${idx})" class="w-12 h-12 bg-gray-800 rounded-xl hover:bg-gray-700 border border-gray-700 flex-shrink-0 flex items-center justify-center p-2 group transition-all hover:scale-105"><img src="${shape.src}" class="w-full h-full object-contain"></button>`).join('');
        document.getElementById('emojiButtons').innerHTML = EMOJIS.map(emoji => `<button onclick="addSticker('emoji', '${emoji}')" class="text-2xl hover:bg-gray-800 rounded-lg p-1 transition-transform hover:scale-125">${emoji}</button>`).join('');

        document.getElementById('textContent').value = state.text;
        document.getElementById('colorPicker').value = state.textColor;
        document.getElementById('fontSize').value = state.fontSize;
        document.getElementById('strokeWidth').value = state.strokeWidth;
        
        if (state.selectedStickerId) {
            stickerControls.classList.remove('hidden');
            noStickerSelected.classList.add('hidden');
            const sticker = state.stickers.find(s => s.id === state.selectedStickerId);
            if (sticker) {
                document.getElementById('stickerScale').value = sticker.scale;
                document.getElementById('stickerRotation').value = sticker.rotation;
            }
        } else {
            stickerControls.classList.add('hidden');
            noStickerSelected.classList.remove('hidden');
        }

        const btnSafe = document.getElementById('btnSafeZone');
        btnSafe.className = `text-[10px] px-2 py-0.5 rounded border transition-colors ${state.showSafeZone ? 'bg-green-500/10 text-green-400 border-green-500/50' : 'border-gray-600 text-gray-400'}`;

        if (state.image) {
            btnDownload.disabled = false;
            btnDownload.classList.remove('grayscale', 'opacity-50', 'cursor-not-allowed');
            document.getElementById('uploadText').innerText = "Click to Change Image";
        } else {
            btnDownload.disabled = true;
            btnDownload.classList.add('grayscale', 'opacity-50', 'cursor-not-allowed');
        }

        // Update Filters UI
        document.getElementById('filterBrightness').value = state.filters.brightness;
        document.getElementById('filterContrast').value = state.filters.contrast;
        document.getElementById('filterSaturate').value = state.filters.saturate;
    }

    function resizeCanvas() { canvas.width = 1280; canvas.height = 720; }

    function drawCanvas() {
        const width = canvas.width;
        const height = canvas.height;
        ctx.clearRect(0, 0, width, height);

        if (state.image) {
            const scale = Math.max(width / state.image.width, height / state.image.height);
            const x = (width / 2) - (state.image.width / 2) * scale;
            const y = (height / 2) - (state.image.height / 2) * scale;
            
            ctx.filter = `brightness(${state.filters.brightness}%) contrast(${state.filters.contrast}%) saturate(${state.filters.saturate}%)`;
            ctx.drawImage(state.image, x, y, state.image.width * scale, state.image.height * scale);
            ctx.filter = 'none'; 
        } else {
            ctx.fillStyle = '#0f172a'; ctx.fillRect(0, 0, width, height);
            ctx.fillStyle = '#1e293b'; ctx.beginPath(); ctx.arc(width/2, height/2, 100, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = '#475569'; ctx.font = 'bold 30px Montserrat'; ctx.textAlign = 'center'; ctx.fillText('Upload an Image to Start', width / 2, height / 2);
        }

        state.stickers.forEach(sticker => {
            ctx.save();
            ctx.translate(sticker.x, sticker.y);
            ctx.rotate((sticker.rotation * Math.PI) / 180);
            ctx.scale(sticker.scaleX, 1); 
            ctx.scale(sticker.scale, sticker.scale); 

            ctx.shadowColor = 'rgba(0,0,0,0.5)'; ctx.shadowBlur = 15; ctx.shadowOffsetX = 5; ctx.shadowOffsetY = 5;

            if (sticker.type === 'emoji') {
                ctx.font = '100px Arial'; ctx.textAlign = 'center'; ctx.textBaseline = 'middle'; ctx.fillText(sticker.content, 0, 0);
            } else {
                const img = new Image(); img.src = sticker.content;
                ctx.drawImage(img, -100, -100, 200, 200);
            }
            ctx.restore();

            if (sticker.id === state.selectedStickerId) {
                ctx.save();
                ctx.translate(sticker.x, sticker.y);
                ctx.rotate((sticker.rotation * Math.PI) / 180);
                ctx.strokeStyle = '#3b82f6'; ctx.lineWidth = 4; ctx.setLineDash([10, 5]);
                const boxSize = sticker.type === 'emoji' ? 120 * sticker.scale : 220 * sticker.scale;
                ctx.strokeRect(-boxSize/2, -boxSize/2, boxSize, boxSize);
                ctx.restore();
            }
        });

        if (state.showSafeZone) {
            ctx.save(); ctx.fillStyle = 'rgba(0, 0, 0, 0.6)'; 
            const safeW = 180; const safeH = 60;
            ctx.fillRect(width - safeW - 20, height - safeH - 20, safeW, safeH);
            ctx.fillStyle = 'white'; ctx.font = 'bold 16px Arial'; ctx.textAlign = 'center'; ctx.fillText('TIMESTAMP', width - (safeW/2) - 20, height - (safeH/2) - 15);
            ctx.restore();
        }

        if (state.text) {
            ctx.font = `900 ${state.fontSize}px "${state.fontFamily}", sans-serif`;
            let x = width / 2; let y = height / 2; let textAlign = 'center';
            const padding = 80; const fontSize = parseInt(state.fontSize);

            switch(state.textPosition) {
                case 'top-left': x = padding; y = padding + (fontSize/2); textAlign = 'left'; break;
                case 'top-center': x = width / 2; y = padding + (fontSize/2); textAlign = 'center'; break;
                case 'top-right': x = width - padding; y = padding + (fontSize/2); textAlign = 'right'; break;
                case 'mid-left': x = padding; y = height / 2; textAlign = 'left'; break;
                case 'center': x = width / 2; y = height / 2; textAlign = 'center'; break;
                case 'mid-right': x = width - padding; y = height / 2; textAlign = 'right'; break;
                case 'bottom-left': x = padding; y = height - padding - (fontSize/2); textAlign = 'left'; break;
                case 'bottom-center': x = width / 2; y = height - padding - (fontSize/2); textAlign = 'center'; break;
                case 'bottom-right': x = width - padding; y = height - padding - (fontSize/2); textAlign = 'right'; break;
            }
            ctx.textAlign = textAlign; ctx.textBaseline = 'middle';
            const lines = state.text.split('\n');
            const lineHeight = fontSize * 1.1;
            const totalHeight = (lines.length - 1) * lineHeight;
            const startY = y - (totalHeight / 2);

            lines.forEach((line, index) => {
                const lineY = startY + (index * lineHeight);
                if (state.shadowBlur > 0) {
                    ctx.shadowColor = 'rgba(0,0,0,0.8)'; ctx.shadowBlur = state.shadowBlur; ctx.shadowOffsetX = 8; ctx.shadowOffsetY = 8;
                }
                if (state.strokeWidth > 0) {
                    ctx.strokeStyle = 'black'; ctx.lineWidth = state.strokeWidth; ctx.lineJoin = 'round'; ctx.strokeText(line.toUpperCase(), x, lineY);
                }
                ctx.fillStyle = state.textColor; ctx.fillText(line.toUpperCase(), x, lineY);
            });
        }
    }

    // HANDLERS
    window.setFont = (font) => { state.fontFamily = font; renderUI(); drawCanvas(); };
    window.setColor = (color) => { state.textColor = color; renderUI(); drawCanvas(); };
    window.setPosition = (pos) => { state.textPosition = pos; renderUI(); drawCanvas(); };
    window.addShape = (idx) => { addSticker('shape', SHAPE_BUTTONS[idx].src); };
    window.addSticker = (type, content) => {
        const newSticker = { id: Date.now().toString(), type, content, x: 640, y: 360, scale: 1, scaleX: 1, rotation: 0 };
        state.stickers.push(newSticker); state.selectedStickerId = newSticker.id; renderUI(); drawCanvas();
    };

    // RESET FUNCTION
    function resetApp() {
        if(confirm("Are you sure you want to reset all settings? Your image will stay.")) {
            state.text = "WATCH THIS!";
            state.textColor = "#FFFFFF";
            state.fontFamily = "Anton";
            state.fontSize = 140;
            state.strokeWidth = 15;
            state.shadowBlur = 20;
            state.textPosition = 'center';
            state.showSafeZone = true;
            state.stickers = [];
            state.selectedStickerId = null;
            state.filters = { brightness: 100, contrast: 100, saturate: 100 };
            renderUI();
            drawCanvas();
        }
    }

    function setupEventListeners() {
        document.getElementById('imageInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image(); img.onload = () => { state.image = img; document.getElementById('previewThumb').src = img.src; document.getElementById('previewThumb').classList.remove('hidden'); renderUI(); drawCanvas(); }; img.src = event.target.result;
                }; reader.readAsDataURL(file);
            }
        });
        document.getElementById('textContent').addEventListener('input', (e) => { state.text = e.target.value; drawCanvas(); });
        document.getElementById('colorPicker').addEventListener('input', (e) => { state.textColor = e.target.value; drawCanvas(); });
        document.getElementById('fontSize').addEventListener('input', (e) => { state.fontSize = e.target.value; drawCanvas(); });
        document.getElementById('strokeWidth').addEventListener('input', (e) => { state.strokeWidth = e.target.value; drawCanvas(); });
        document.getElementById('btnSafeZone').addEventListener('click', () => { state.showSafeZone = !state.showSafeZone; renderUI(); drawCanvas(); });
        
        document.getElementById('filterBrightness').addEventListener('input', (e) => { state.filters.brightness = e.target.value; drawCanvas(); });
        document.getElementById('filterContrast').addEventListener('input', (e) => { state.filters.contrast = e.target.value; drawCanvas(); });
        document.getElementById('filterSaturate').addEventListener('input', (e) => { state.filters.saturate = e.target.value; drawCanvas(); });

        document.getElementById('stickerScale').addEventListener('input', (e) => { const s = state.stickers.find(x => x.id === state.selectedStickerId); if (s) { s.scale = e.target.value; drawCanvas(); } });
        document.getElementById('stickerRotation').addEventListener('input', (e) => { const s = state.stickers.find(x => x.id === state.selectedStickerId); if (s) { s.rotation = e.target.value; drawCanvas(); } });
        document.getElementById('btnDeleteSticker').addEventListener('click', () => { state.stickers = state.stickers.filter(s => s.id !== state.selectedStickerId); state.selectedStickerId = null; renderUI(); drawCanvas(); });
        document.getElementById('btnFlipSticker').addEventListener('click', () => { const s = state.stickers.find(x => x.id === state.selectedStickerId); if (s) { s.scaleX = s.scaleX * -1; drawCanvas(); } });
        
        document.getElementById('btnMagicRemix').addEventListener('click', () => {
            state.fontFamily = FONTS[Math.floor(Math.random() * FONTS.length)].value;
            state.textColor = COLORS[Math.floor(Math.random() * COLORS.length)];
            const positions = ['top-left', 'top-center', 'top-right', 'center', 'bottom-center'];
            state.textPosition = positions[Math.floor(Math.random() * positions.length)];
            state.strokeWidth = Math.floor(Math.random() * 20) + 10;
            renderUI(); drawCanvas();
        });

        document.getElementById('btnResetApp').addEventListener('click', resetApp);

        btnDownload.addEventListener('click', async () => {
            if (!state.image) return;
            const btn = document.getElementById('btnDownload');
            const originalText = btn.innerHTML;
            btn.innerHTML = `SAVING...`;
            const getBlob = (quality, type) => new Promise(resolve => canvas.toBlob(resolve, type, quality));
            let blob = await getBlob(1, 'image/png');
            let extension = 'png';
            if (blob.size > 2 * 1024 * 1024) {
                 extension = 'jpg'; let quality = 0.95;
                 while (quality > 0.1) { blob = await getBlob(quality, 'image/jpeg'); if (blob.size < 2000000) break; quality -= 0.1; }
            }
            const url = URL.createObjectURL(blob); const link = document.createElement('a'); link.download = `tubethumb-${Date.now()}.${extension}`; link.href = url; link.click(); URL.revokeObjectURL(url);
            document.getElementById('downloadStatus').classList.remove('opacity-0');
            setTimeout(() => { btn.innerHTML = originalText; document.getElementById('downloadStatus').classList.add('opacity-0'); }, 3000);
        });

        // Canvas Interaction
        const getCanvasCoords = (e) => {
            const rect = canvas.getBoundingClientRect(); const scaleX = canvas.width / rect.width; const scaleY = canvas.height / rect.height;
            let clientX = e.touches ? e.touches[0].clientX : e.clientX; let clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return { x: (clientX - rect.left) * scaleX, y: (clientY - rect.top) * scaleY };
        };
        const handleStart = (e) => {
            e.preventDefault(); const coords = getCanvasCoords(e);
            for (let i = state.stickers.length - 1; i >= 0; i--) {
                const s = state.stickers[i]; const dist = Math.hypot(s.x - coords.x, s.y - coords.y); const hitRadius = s.type === 'emoji' ? 60 * s.scale : 100 * s.scale;
                if (dist < hitRadius) {
                    state.selectedStickerId = s.id; state.isDragging = true; state.dragOffset = { x: coords.x - s.x, y: coords.y - s.y }; renderUI(); drawCanvas(); return;
                }
            }
            state.selectedStickerId = null; renderUI(); drawCanvas();
        };
        const handleMove = (e) => {
            if (!state.isDragging || !state.selectedStickerId) return; e.preventDefault(); const coords = getCanvasCoords(e);
            const s = state.stickers.find(x => x.id === state.selectedStickerId); if (s) { s.x = coords.x - state.dragOffset.x; s.y = coords.y - state.dragOffset.y; drawCanvas(); }
        };
        const handleEnd = () => { state.isDragging = false; };

        canvas.addEventListener('mousedown', handleStart); canvas.addEventListener('mousemove', handleMove); canvas.addEventListener('mouseup', handleEnd); canvas.addEventListener('mouseleave', handleEnd);
        canvas.addEventListener('touchstart', handleStart); canvas.addEventListener('touchmove', handleMove); canvas.addEventListener('touchend', handleEnd);
    }
    document.fonts.ready.then(init);
</script>
</body>
</html>